#!/bin/bash
set -eu

source '/usr/local/bin/func.sh'

usage() {
    echo "usage: $0 CLIENT_NAME"
}

CLIENT_NAME="$1"

if [ -z "$CLIENT_NAME" ]; then
  echo "Invalid option" >&2
  usage
  exit 1
fi

if [ ! -f "${EASYRSA_PKI}/reqs/${CLIENT_NAME}.req" ];then
  echo "[ERROR] 账户不存在"
  exit 1
fi

revoke_client_certificate(){
    easyrsa revoke "$1"
    echo "Generating the Certificate Revocation List :"
    easyrsa gen-crl
}

remove_files(){
    rm -v "$EASYRSA_PKI/issued/${1}.crt"
    rm -v "$EASYRSA_PKI/private/${1}.key"
    rm -v "$EASYRSA_PKI/reqs/${1}.req"
}

revoke_client_certificate "$CLIENT_NAME"
#remove_files "$CLIENT_NAME"